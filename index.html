<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIRP v2.13.0 - Financial Dashboard & Health Monitoring</title>
    <style>
        /* ==================== SAP-like Design System ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* SAP Color Palette */
            --sap-primary: #0854A0;
            --sap-primary-hover: #0066B3;
            --sap-secondary: #32363A;
            --sap-background: #F7F7F7;
            --sap-surface: #FFFFFF;
            --sap-border: #D9D9D9;
            --sap-text-primary: #32363A;
            --sap-text-secondary: #6A6D70;
            --sap-text-disabled: #B3B3B3;
            --sap-success: #107E3E;
            --sap-warning: #E9730C;
            --sap-error: #BB0000;
            --sap-info: #0854A0;
            --sap-shadow: rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: var(--sap-background);
            color: var(--sap-text-primary);
            line-height: 1.5;
        }

        /* Top Navigation Bar */
        .top-nav {
            background: var(--sap-surface);
            border-bottom: 1px solid var(--sap-border);
            padding: 0;
            display: flex;
            align-items: stretch;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px var(--sap-shadow);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            background: var(--sap-primary);
            color: white;
            min-width: 280px;
        }

        .logo-icon {
            font-size: 24px;
        }

        .logo-text {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .nav-center {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 0 24px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--sap-text-secondary);
            font-size: 14px;
        }

        .breadcrumb-separator {
            color: var(--sap-border);
        }

        .breadcrumb-current {
            color: var(--sap-text-primary);
            font-weight: 500;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 0 24px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--sap-text-secondary);
        }

        /* Main Layout */
        .main-container {
            display: flex;
            height: calc(100vh - 49px);
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: var(--sap-surface);
            border-right: 1px solid var(--sap-border);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar-section {
            border-bottom: 1px solid var(--sap-border);
        }

        .sidebar-header {
            padding: 12px 16px;
            background: #FAFAFA;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--sap-text-secondary);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            transition: background 0.2s;
        }

        .sidebar-header:hover {
            background: #F0F0F0;
        }

        .sidebar-header-icon {
            font-size: 14px;
            transition: transform 0.3s;
        }

        .sidebar-header-icon.collapsed {
            transform: rotate(-90deg);
        }

        .sidebar-section-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .sidebar-section-content.collapsed {
            max-height: 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--sap-text-primary);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: #F5F5F5;
        }

        .nav-item.active {
            background: #E8F0F8;
            border-left-color: var(--sap-primary);
            color: var(--sap-primary);
            font-weight: 500;
        }

        .nav-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--sap-background);
            overflow: hidden;
        }

        .content-header {
            background: var(--sap-surface);
            padding: 20px 32px;
            border-bottom: 1px solid var(--sap-border);
        }

        .content-title {
            font-size: 24px;
            font-weight: 400;
            color: var(--sap-text-primary);
            margin-bottom: 4px;
        }

        .content-subtitle {
            font-size: 14px;
            color: var(--sap-text-secondary);
        }

        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px 32px;
        }

        /* Dashboard Styles */
        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .dashboard-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 24px;
        }

        /* KPI Cards */
        .kpi-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: var(--sap-surface);
            border: 1px solid var(--sap-border);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .kpi-card:hover {
            box-shadow: 0 4px 12px var(--sap-shadow);
            transform: translateY(-2px);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--sap-primary);
        }

        .kpi-card.success::before { background: var(--sap-success); }
        .kpi-card.warning::before { background: var(--sap-warning); }
        .kpi-card.error::before { background: var(--sap-error); }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .kpi-title {
            font-size: 13px;
            color: var(--sap-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .kpi-icon {
            font-size: 24px;
            opacity: 0.7;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--sap-text-primary);
            margin-bottom: 8px;
            line-height: 1;
        }

        .kpi-value.positive { color: var(--sap-success); }
        .kpi-value.negative { color: var(--sap-error); }

        .kpi-subtitle {
            font-size: 12px;
            color: var(--sap-text-secondary);
        }

        .kpi-trend {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 8px;
        }

        .kpi-trend.up {
            background: rgba(16, 126, 62, 0.1);
            color: var(--sap-success);
        }

        .kpi-trend.down {
            background: rgba(187, 0, 0, 0.1);
            color: var(--sap-error);
        }

        /* Health Status */
        .health-section {
            background: var(--sap-surface);
            border: 1px solid var(--sap-border);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .health-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .health-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--sap-text-primary);
        }

        .health-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .health-badge.healthy {
            background: rgba(16, 126, 62, 0.1);
            color: var(--sap-success);
        }

        .health-badge.warning {
            background: rgba(233, 115, 12, 0.1);
            color: var(--sap-warning);
        }

        .health-badge.critical {
            background: rgba(187, 0, 0, 0.1);
            color: var(--sap-error);
        }

        .health-checks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .health-check {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #FAFAFA;
            border-radius: 6px;
        }

        .health-check-icon {
            font-size: 20px;
        }

        .health-check-label {
            font-size: 13px;
            color: var(--sap-text-secondary);
        }

        /* Exceptions & Actions */
        .two-column-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        @media (max-width: 1024px) {
            .two-column-section {
                grid-template-columns: 1fr;
            }
        }

        .info-panel {
            background: var(--sap-surface);
            border: 1px solid var(--sap-border);
            border-radius: 8px;
            padding: 24px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--sap-text-primary);
        }

        .panel-count {
            background: var(--sap-primary);
            color: white;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .exception-item, .action-item {
            padding: 12px;
            background: #FAFAFA;
            border-left: 3px solid var(--sap-border);
            border-radius: 4px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .exception-item:hover, .action-item:hover {
            background: #F0F0F0;
            cursor: pointer;
        }

        .exception-item.high { border-left-color: var(--sap-error); }
        .exception-item.medium { border-left-color: var(--sap-warning); }
        .exception-item.low { border-left-color: var(--sap-info); }

        .exception-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        .exception-message {
            font-size: 14px;
            color: var(--sap-text-primary);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .exception-action {
            font-size: 12px;
            color: var(--sap-text-secondary);
        }

        .severity-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-badge.high {
            background: rgba(187, 0, 0, 0.1);
            color: var(--sap-error);
        }

        .severity-badge.medium {
            background: rgba(233, 115, 12, 0.1);
            color: var(--sap-warning);
        }

        /* Recent Activity */
        .activity-panel {
            background: var(--sap-surface);
            border: 1px solid var(--sap-border);
            border-radius: 8px;
            padding: 24px;
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid var(--sap-border);
            transition: all 0.2s;
        }

        .activity-item:hover {
            background: #FAFAFA;
            cursor: pointer;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-left {
            flex: 1;
        }

        .activity-title {
            font-size: 14px;
            color: var(--sap-text-primary);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .activity-meta {
            font-size: 12px;
            color: var(--sap-text-secondary);
        }

        .activity-amount {
            font-size: 15px;
            font-weight: 600;
            color: var(--sap-text-primary);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--sap-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .loading-spinner {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            border: 4px solid var(--sap-border);
            border-top: 4px solid var(--sap-primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .refresh-btn {
            background: var(--sap-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            background: var(--sap-primary-hover);
        }

        /* Iframe Container */
        .iframe-container {
            display: none;
            width: 100%;
            height: 100%;
        }

        .iframe-container.active {
            display: block;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--sap-primary);
            color: white;
            border-color: var(--sap-primary);
        }

        .btn-primary:hover {
            background: var(--sap-primary-hover);
            border-color: var(--sap-primary-hover);
        }

        .btn-secondary {
            background: var(--sap-surface);
            color: var(--sap-text-primary);
            border-color: var(--sap-border);
        }

        .btn-secondary:hover {
            background: #F5F5F5;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #F0F0F0;
        }

        ::-webkit-scrollbar-thumb {
            background: #C0C0C0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #A0A0A0;
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <div class="top-nav">
        <div class="logo-section">
            <div class="logo-icon">‚ö°</div>
            <div class="logo-text">AIRP v2.13.0</div>
        </div>

        <div class="nav-center">
            <div class="breadcrumb">
                <span>Home</span>
                <span class="breadcrumb-separator">‚Ä∫</span>
                <span class="breadcrumb-current" id="current-page">Dashboard</span>
            </div>
        </div>

        <div class="nav-right">
            <div class="user-info">
                <span>üë§</span>
                <span>ACME Corporation</span>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <!-- Master Data Section -->
            <div class="sidebar-section">
                <div class="sidebar-header" onclick="toggleSection(this)">
                    <span>1. Master Data</span>
                    <span class="sidebar-header-icon">‚ñº</span>
                </div>
                <div class="sidebar-section-content">
                    <a class="nav-item" onclick="loadContent('chart-of-accounts.html')">
                        <span class="nav-icon">üìë</span>
                        <span>Chart of Accounts</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('vendors.html')">
                        <span class="nav-icon">üè™</span>
                        <span>Vendors</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('customers.html')">
                        <span class="nav-icon">üë•</span>
                        <span>Customers</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('bank-accounts.html')">
                        <span class="nav-icon">üè¶</span>
                        <span>Bank Accounts</span>
                    </a>
                </div>
            </div>

            <!-- Transactions Section -->
            <div class="sidebar-section">
                <div class="sidebar-header" onclick="toggleSection(this)">
                    <span>2. Transactions</span>
                    <span class="sidebar-header-icon">‚ñº</span>
                </div>
                <div class="sidebar-section-content">
                    <a class="nav-item" onclick="loadContent('post-je.html')" style="background: #FFF3CD; border-left-color: #E9730C;">
                        <span class="nav-icon">‚úçÔ∏è</span>
                        <span><strong>Post Journal Entry</strong></span>
                    </a>
                </div>
            </div>

            <!-- Ledgers & Registers Section -->
            <div class="sidebar-section">
                <div class="sidebar-header" onclick="toggleSection(this)">
                    <span>3. Ledgers & Registers</span>
                    <span class="sidebar-header-icon">‚ñº</span>
                </div>
                <div class="sidebar-section-content">
                    <a class="nav-item" onclick="loadContent('je-register.html')">
                        <span class="nav-icon">üìã</span>
                        <span>Journal Entry Register</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('gl-line-items.html')">
                        <span class="nav-icon">üìñ</span>
                        <span>General Ledger</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('vendor-ledger.html')">
                        <span class="nav-icon">üè¢</span>
                        <span>Vendor Ledger</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('customer-ledger.html')">
                        <span class="nav-icon">üë§</span>
                        <span>Customer Ledger</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('account-balances.html')">
                        <span class="nav-icon">üí∞</span>
                        <span>Account Balances</span>
                    </a>
                </div>
            </div>

            <!-- Financial Reports Section -->
            <div class="sidebar-section">
                <div class="sidebar-header" onclick="toggleSection(this)">
                    <span>4. Financial Reports</span>
                    <span class="sidebar-header-icon">‚ñº</span>
                </div>
                <div class="sidebar-section-content">
                    <a class="nav-item" onclick="loadContent('trial-balance.html')">
                        <span class="nav-icon">‚öñÔ∏è</span>
                        <span>Trial Balance</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('income-statement.html')">
                        <span class="nav-icon">üìä</span>
                        <span>Income Statement</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('balance-sheet.html')">
                        <span class="nav-icon">üìà</span>
                        <span>Balance Sheet</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('cash-flow-statement.html')">
                        <span class="nav-icon">üí∏</span>
                        <span>Cash Flow Statement</span>
                    </a>
                </div>
            </div>

            <!-- System Section -->
            <div class="sidebar-section">
                <div class="sidebar-header" onclick="toggleSection(this)">
                    <span>5. System & Administration</span>
                    <span class="sidebar-header-icon">‚ñº</span>
                </div>
                <div class="sidebar-section-content">
                    <a class="nav-item" onclick="loadContent('user-management.html')" style="background: #FFF3CD; border-left-color: #E9730C;">
                        <span class="nav-icon">üë•</span>
                        <span><strong>User Management</strong></span>
                    </a>
                    <a class="nav-item" onclick="loadContent('database-explorer.html')">
                        <span class="nav-icon">üóÑÔ∏è</span>
                        <span>Database Explorer</span>
                    </a>
                </div>
            </div>

            <!-- AI Assistant Section (NEW v2.11.0) -->
            <div class="sidebar-section" style="border-top: 2px solid #0854A0;">
                <div class="sidebar-header" onclick="toggleSection(this)" style="background: linear-gradient(135deg, #E8F0F8 0%, #F0F8FF 100%);">
                    <span style="color: #0854A0; font-weight: 700;">ü§ñ 6. AI ASSISTANT</span>
                    <span style="background: linear-gradient(135deg, #0854A0, #0066B3); color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 700; letter-spacing: 0.5px;">NEW</span>
                </div>
                <div class="sidebar-section-content">
                    <a class="nav-item" onclick="loadContent('chaterp.html')" style="background: #E8F0F8;">
                        <span class="nav-icon">üí¨</span>
                        <span><strong>ChatERP</strong></span>
                    </a>
                    <a class="nav-item" onclick="loadContent('classify-demo.html')">
                        <span class="nav-icon">üè∑Ô∏è</span>
                        <span>AI Classification</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('recon-demo.html')">
                        <span class="nav-icon">üîÑ</span>
                        <span>AI Reconciliation</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('cashflow-demo.html')">
                        <span class="nav-icon">üìà</span>
                        <span>AI Cash Forecast</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('narrative-demo.html')">
                        <span class="nav-icon">üìù</span>
                        <span>AI Narratives</span>
                    </a>
                    <a class="nav-item" onclick="loadContent('policy-demo.html')">
                        <span class="nav-icon">üìã</span>
                        <span>AI Policy Advisor</span>
                    </a>
                    <a class="nav-item" onclick="window.open('http://localhost:8007/health', '_blank')">
                        <span class="nav-icon">üìä</span>
                        <span>Context Stats</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard View -->
            <div id="welcome-view">
                <div class="content-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div class="content-title">Financial Dashboard</div>
                            <div class="content-subtitle">Real-time KPIs, Health Status, and Action Items</div>
                        </div>
                        <button class="refresh-btn" onclick="loadDashboard()">
                            <span>üîÑ</span>
                            <span>Refresh</span>
                        </button>
                    </div>
                </div>

                <div class="content-body">
                    <div class="dashboard-container" id="dashboard-content">
                        <!-- Loading spinner -->
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <div style="color: var(--sap-text-secondary);">Loading dashboard...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content View (for iframes) -->
            <div id="content-view" class="iframe-container">
                <iframe id="content-frame"></iframe>
            </div>
        </div>
    </div>

    <script>
        let currentContent = null;
        const TENANT_ID = '00000000-0000-0000-0000-000000000001';
        const REPORTING_API = 'http://localhost:3008';

        // Load dashboard on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
            // Auto-refresh every 30 seconds
            setInterval(loadDashboard, 30000);
        });

        async function loadDashboard() {
            const dashboardContent = document.getElementById('dashboard-content');

            try {
                const response = await fetch(`${REPORTING_API}/reports/dashboard-kpis?tenant_id=${TENANT_ID}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                renderDashboard(data);
            } catch (error) {
                console.error('Dashboard loading error:', error);
                dashboardContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Unable to load dashboard</div>
                        <div style="font-size: 14px;">${error.message}</div>
                        <button class="refresh-btn" onclick="loadDashboard()" style="margin-top: 20px;">
                            <span>üîÑ</span>
                            <span>Retry</span>
                        </button>
                    </div>
                `;
            }
        }

        function renderDashboard(data) {
            const dashboardContent = document.getElementById('dashboard-content');
            const kpis = data.kpis;
            const health = data.health;

            dashboardContent.innerHTML = `
                <!-- KPI Cards -->
                <div class="kpi-section">
                    ${renderKPICard('üí∞ Cash Balance', formatCurrency(kpis.financial.cash_balance), 'Total cash in bank accounts', kpis.financial.cash_balance >= 0 ? 'success' : 'error')}
                    ${renderKPICard('üìà Total Revenue', formatCurrency(kpis.financial.total_revenue), 'Revenue from all sources', 'success')}
                    ${renderKPICard('üìâ Total Expenses', formatCurrency(kpis.financial.total_expenses), 'Operating expenses', 'warning')}
                    ${renderKPICard('üíµ Net Income', formatCurrency(kpis.financial.net_income), `Profit margin: ${kpis.financial.profit_margin.toFixed(1)}%`, kpis.financial.net_income >= 0 ? 'success' : 'error', kpis.financial.net_income >= 0)}
                    ${renderKPICard('üè™ Vendors', kpis.operational.vendor_count.toString(), `Payable: ${formatCurrency(kpis.operational.total_payable)}`)}
                    ${renderKPICard('üë• Customers', kpis.operational.customer_count.toString(), `Receivable: ${formatCurrency(kpis.operational.total_receivable)}`)}
                    ${renderKPICard('üíº Working Capital', formatCurrency(kpis.operational.working_capital), 'Receivable - Payable', kpis.operational.working_capital >= 0 ? 'success' : 'warning')}
                    ${renderKPICard('‚öñÔ∏è Trial Balance', health.checks.trial_balance ? '‚úì Balanced' : '‚úó Out of Balance', `Variance: ${formatCurrency(kpis.accounting.variance)}`, health.checks.trial_balance ? 'success' : 'error')}
                </div>

                <!-- Health Status -->
                <div class="health-section">
                    <div class="health-header">
                        <div class="health-title">System Health</div>
                        <div class="health-badge ${health.status}">
                            <span>${getHealthIcon(health.status)}</span>
                            <span>${health.status.charAt(0).toUpperCase() + health.status.slice(1)} (${health.score}/100)</span>
                        </div>
                    </div>
                    <div class="health-checks">
                        ${renderHealthCheck(health.checks.trial_balance, 'Trial Balance')}
                        ${renderHealthCheck(health.checks.ap_balance, 'AP Balance')}
                        ${renderHealthCheck(health.checks.ar_balance, 'AR Balance')}
                        ${renderHealthCheck(health.checks.has_activity, 'Recent Activity')}
                    </div>
                </div>

                <!-- Exceptions and Pending Actions -->
                <div class="two-column-section">
                    <!-- Exceptions -->
                    <div class="info-panel">
                        <div class="panel-header">
                            <div class="panel-title">‚ö†Ô∏è Exceptions</div>
                            ${data.exceptions.length > 0 ? `<div class="panel-count">${data.exceptions.length}</div>` : ''}
                        </div>
                        ${data.exceptions.length > 0 ?
                            data.exceptions.map(ex => renderException(ex)).join('') :
                            '<div class="empty-state"><div class="empty-state-icon">‚úì</div><div>No exceptions found</div></div>'
                        }
                    </div>

                    <!-- Pending Actions -->
                    <div class="info-panel">
                        <div class="panel-header">
                            <div class="panel-title">üìã Pending Actions</div>
                            ${data.pending_actions.length > 0 ? `<div class="panel-count">${data.pending_actions.length}</div>` : ''}
                        </div>
                        ${data.pending_actions.length > 0 ?
                            data.pending_actions.map(action => renderPendingAction(action)).join('') :
                            '<div class="empty-state"><div class="empty-state-icon">‚úì</div><div>All caught up!</div></div>'
                        }
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="activity-panel">
                    <div class="panel-header">
                        <div class="panel-title">üìä Recent Activity</div>
                        <a href="#" onclick="loadContent('je-register.html'); return false;" style="font-size: 13px; color: var(--sap-primary); text-decoration: none;">View All ‚Üí</a>
                    </div>
                    ${data.recent_activity.length > 0 ?
                        data.recent_activity.map(activity => renderActivity(activity)).join('') :
                        '<div class="empty-state"><div class="empty-state-icon">üì≠</div><div>No recent activity</div></div>'
                    }
                </div>
            `;
        }

        function renderKPICard(title, value, subtitle, type = '', isPositive = null) {
            const valueClass = isPositive !== null ? (isPositive ? 'positive' : 'negative') : '';
            return `
                <div class="kpi-card ${type}">
                    <div class="kpi-header">
                        <div class="kpi-title">${title.split(' ').slice(1).join(' ')}</div>
                        <div class="kpi-icon">${title.split(' ')[0]}</div>
                    </div>
                    <div class="kpi-value ${valueClass}">${value}</div>
                    <div class="kpi-subtitle">${subtitle}</div>
                </div>
            `;
        }

        function renderHealthCheck(passed, label) {
            return `
                <div class="health-check">
                    <div class="health-check-icon">${passed ? '‚úÖ' : '‚ùå'}</div>
                    <div class="health-check-label">${label}</div>
                </div>
            `;
        }

        function renderException(exception) {
            return `
                <div class="exception-item ${exception.severity}">
                    <div class="exception-header">
                        <div style="flex: 1;">
                            <div class="exception-message">${exception.message}</div>
                            <div class="exception-action">Action: ${exception.action}</div>
                        </div>
                        <div class="severity-badge ${exception.severity}">${exception.severity}</div>
                    </div>
                </div>
            `;
        }

        function renderPendingAction(action) {
            return `
                <div class="action-item" onclick="loadContent('${action.link}')">
                    <div>
                        <div class="exception-message">${action.message}</div>
                        <div class="exception-action">Click to view</div>
                    </div>
                </div>
            `;
        }

        function renderActivity(activity) {
            return `
                <div class="activity-item" onclick="alert('Entry ID: ${activity.entry_id}')">
                    <div class="activity-left">
                        <div class="activity-title">${activity.entry_number || activity.entry_id.substring(0, 8)} - ${activity.description}</div>
                        <div class="activity-meta">${formatDate(activity.entry_date)} ‚Ä¢ ${activity.entry_type} ‚Ä¢ ${activity.line_count} lines</div>
                    </div>
                    <div class="activity-amount">${formatCurrency(activity.amount)}</div>
                </div>
            `;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-AE', {
                style: 'currency',
                currency: 'AED',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return new Intl.DateTimeFormat('en-GB', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            }).format(date);
        }

        function getHealthIcon(status) {
            switch(status) {
                case 'healthy': return '‚úÖ';
                case 'warning': return '‚ö†Ô∏è';
                case 'critical': return 'üî¥';
                default: return '‚ùì';
            }
        }

        function loadContent(url) {
            const welcomeView = document.getElementById('welcome-view');
            const contentView = document.getElementById('content-view');
            const contentFrame = document.getElementById('content-frame');

            // Hide welcome, show iframe
            welcomeView.style.display = 'none';
            contentView.classList.add('active');

            // Load content
            contentFrame.src = url;
            currentContent = url;

            // Update breadcrumb
            updateBreadcrumb(url);

            // Update active nav item
            updateActiveNav(url);
        }

        function updateBreadcrumb(url) {
            const breadcrumb = document.getElementById('current-page');
            const filename = url.split('?')[0].split('.html')[0];

            const pageNames = {
                'chart-of-accounts': 'Chart of Accounts',
                'vendors': 'Vendors',
                'customers': 'Customers',
                'bank-accounts': 'Bank Accounts',
                'post-je': 'Journal Entry',
                'je-register': 'Journal Entry Register',
                'gl-line-items': 'General Ledger',
                'vendor-ledger': 'Vendor Ledger',
                'customer-ledger': 'Customer Ledger',
                'account-balances': 'Account Balances',
                'trial-balance': 'Trial Balance',
                'income-statement': 'Income Statement',
                'balance-sheet': 'Balance Sheet',
                'cash-flow-statement': 'Cash Flow Statement',
                'master-data': 'Master Data',
                'database-explorer': 'Database Explorer',
                'chaterp': 'ChatERP - AI Assistant',
                'classify-demo': 'AI Transaction Classification',
                'recon-demo': 'AI Bank Reconciliation',
                'cashflow-demo': 'AI Cash Flow Forecasting',
                'narrative-demo': 'AI Report Narratives',
                'policy-demo': 'AI Policy Advisor'
            };

            breadcrumb.textContent = pageNames[filename] || 'Dashboard';
        }

        function updateActiveNav(url) {
            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Find and activate matching nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                const onClick = item.getAttribute('onclick');
                if (onClick && onClick.includes(url.split('?')[0])) {
                    item.classList.add('active');
                }
            });
        }

        function toggleSection(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.sidebar-header-icon');

            content.classList.toggle('collapsed');
            icon.classList.toggle('collapsed');
        }
    </script>
</body>
</html>
